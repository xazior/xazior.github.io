<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SuperNØva Smart Locker - Dashboard di gestione dispositivi">
    <title>Dashboard | SuperNØva Smart Locker</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Leaflet Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="app.css">
</head>

<body>
    <!-- Login Screen (shown when not authenticated) -->
    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <span class="logo-icon">◈</span>
                    <span class="logo-text">SuperNØva</span>
                </div>
                <h1>Accedi</h1>
                <p>Inserisci le tue credenziali per accedere alla dashboard</p>
            </div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <div class="input-icon">
                        <i data-lucide="mail"></i>
                        <input type="email" id="login-email" placeholder="nome@esempio.it" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <div class="input-icon">
                        <i data-lucide="lock"></i>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                        <button type="button" class="toggle-password" aria-label="Mostra password">
                            <i data-lucide="eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-row">
                    <label class="checkbox-label">
                        <input type="checkbox" id="remember-me">
                        <span>Ricordami</span>
                    </label>
                    <a href="#" class="forgot-link">Password dimenticata?</a>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i data-lucide="log-in"></i>
                    Accedi
                </button>
            </form>
            <div class="login-footer">
                <p>Non hai un account? <a href="../frontend/index.html#contact">Richiedi accesso</a></p>
            </div>
            <div class="demo-credentials">
                <p><strong>Demo:</strong> demo@example.com / password123</p>
            </div>
        </div>
    </div>

    <!-- Main App (shown when authenticated) -->
    <div class="app-wrapper" id="app-wrapper" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../frontend/index.html" class="sidebar-logo">
                    <span class="logo-icon">◈</span>
                    <span class="logo-text">SuperNØva</span>
                </a>
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i data-lucide="panel-left-close"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <span class="nav-section-title">Generale</span>
                    <a href="#" class="nav-item active" data-page="dashboard">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-item" data-page="devices">
                        <i data-lucide="box"></i>
                        <span>Dispositivi</span>
                        <span class="nav-badge">3</span>
                    </a>
                    <a href="#" class="nav-item" data-page="map">
                        <i data-lucide="map"></i>
                        <span>Mappa</span>
                    </a>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Controllo</span>
                    <a href="#" class="nav-item" data-page="access">
                        <i data-lucide="key"></i>
                        <span>Accessi</span>
                    </a>
                    <a href="#" class="nav-item" data-page="sharing">
                        <i data-lucide="share-2"></i>
                        <span>Condivisioni</span>
                    </a>
                    <a href="#" class="nav-item" data-page="logs">
                        <i data-lucide="scroll-text"></i>
                        <span>Log</span>
                    </a>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Sistema</span>
                    <a href="#" class="nav-item" data-page="alerts">
                        <i data-lucide="bell"></i>
                        <span>Alert</span>
                        <span class="nav-badge alert">2</span>
                    </a>
                    <a href="#" class="nav-item" data-page="settings">
                        <i data-lucide="settings"></i>
                        <span>Impostazioni</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar">
                        <span>LR</span>
                    </div>
                    <div class="user-info">
                        <span class="user-name">Leonardo</span>
                        <span class="user-plan">Premium</span>
                    </div>
                    <button class="user-menu-btn" id="user-menu-btn">
                        <i data-lucide="more-vertical"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i data-lucide="menu"></i>
                </button>
                <div class="topbar-title">
                    <h1 id="page-title">Dashboard</h1>
                </div>
                <div class="topbar-actions">
                    <button class="topbar-btn" id="refresh-btn" title="Aggiorna">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="topbar-btn notification-btn" id="notification-btn" title="Notifiche">
                        <i data-lucide="bell"></i>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="topbar-btn" id="logout-btn" title="Esci">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div class="page" id="page-dashboard">
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i data-lucide="box"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-devices">3</span>
                                <span class="stat-label">Dispositivi</span>
                            </div>
                            <div class="stat-trend positive">
                                <i data-lucide="trending-up"></i>
                                <span>Tutti online</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i data-lucide="unlock"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-unlocks">47</span>
                                <span class="stat-label">Aperture (7gg)</span>
                            </div>
                            <div class="stat-trend positive">
                                <i data-lucide="trending-up"></i>
                                <span>+12%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i data-lucide="users"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-shared">5</span>
                                <span class="stat-label">Utenti Condivisi</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i data-lucide="battery-medium"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-battery">72%</span>
                                <span class="stat-label">Batteria Media</span>
                            </div>
                            <div class="stat-trend warning">
                                <i data-lucide="alert-triangle"></i>
                                <span>1 bassa</span>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Content -->
                    <div class="dashboard-grid">
                        <!-- Devices Quick View -->
                        <div class="card devices-quick">
                            <div class="card-header">
                                <h3>I Tuoi Dispositivi</h3>
                                <button class="btn btn-sm btn-outline" data-page="devices">
                                    Vedi tutti
                                    <i data-lucide="arrow-right"></i>
                                </button>
                            </div>
                            <div class="device-list" id="device-list">
                                <!-- Devices will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Map Preview -->
                        <div class="card map-preview">
                            <div class="card-header">
                                <h3>Posizione Dispositivi</h3>
                                <button class="btn btn-sm btn-outline" data-page="map">
                                    Mappa Completa
                                    <i data-lucide="maximize-2"></i>
                                </button>
                            </div>
                            <div class="map-container" id="dashboard-map"></div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="card recent-activity">
                            <div class="card-header">
                                <h3>Attività Recente</h3>
                                <button class="btn btn-sm btn-outline" data-page="logs">
                                    Tutti i log
                                    <i data-lucide="arrow-right"></i>
                                </button>
                            </div>
                            <div class="activity-list" id="activity-list">
                                <!-- Activities will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Analytics Chart -->
                        <div class="card analytics-card">
                            <div class="card-header">
                                <h3>Aperture Ultimi 7 Giorni</h3>
                                <select class="chart-filter" id="chart-filter">
                                    <option value="7">7 giorni</option>
                                    <option value="30">30 giorni</option>
                                    <option value="90">90 giorni</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="activity-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Devices Page -->
                <div class="page" id="page-devices" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>I Tuoi Dispositivi</h2>
                            <p>Gestisci e controlla tutti i tuoi smart locker</p>
                        </div>
                        <button class="btn btn-primary" id="add-device-btn">
                            <i data-lucide="plus"></i>
                            Aggiungi Dispositivo
                        </button>
                    </div>
                    <div class="devices-grid" id="devices-grid">
                        <!-- Device cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Map Page -->
                <div class="page" id="page-map" style="display: none;">
                    <div class="map-page-layout">
                        <div class="map-sidebar">
                            <div class="map-search">
                                <i data-lucide="search"></i>
                                <input type="text" placeholder="Cerca dispositivo..." id="map-search">
                            </div>
                            <div class="map-device-list" id="map-device-list">
                                <!-- Devices will be populated by JavaScript -->
                            </div>
                        </div>
                        <div class="map-main">
                            <div class="map-container full" id="main-map"></div>
                            <div class="map-controls">
                                <button class="map-control-btn" id="map-center" title="Centra mappa">
                                    <i data-lucide="crosshair"></i>
                                </button>
                                <button class="map-control-btn" id="map-zoom-in" title="Zoom in">
                                    <i data-lucide="plus"></i>
                                </button>
                                <button class="map-control-btn" id="map-zoom-out" title="Zoom out">
                                    <i data-lucide="minus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Access Control Page -->
                <div class="page" id="page-access" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>Controllo Accessi</h2>
                            <p>Gestisci permessi e codici di accesso temporanei</p>
                        </div>
                    </div>
                    <div class="access-grid">
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Azioni Rapide</h3>
                            </div>
                            <div class="quick-actions">
                                <button class="action-btn" id="generate-temp-code">
                                    <i data-lucide="key"></i>
                                    <span>Genera Codice Temporaneo</span>
                                </button>
                                <button class="action-btn" id="share-access-btn">
                                    <i data-lucide="user-plus"></i>
                                    <span>Condividi Accesso</span>
                                </button>
                                <button class="action-btn emergency" id="emergency-unlock">
                                    <i data-lucide="shield-alert"></i>
                                    <span>Sblocco Emergenza</span>
                                </button>
                            </div>
                        </div>

                        <!-- Active Permissions -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Permessi Attivi</h3>
                            </div>
                            <div class="permissions-list" id="permissions-list">
                                <!-- Permissions will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Temporary Codes -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Codici Temporanei Attivi</h3>
                            </div>
                            <div class="temp-codes-list" id="temp-codes-list">
                                <div class="empty-state">
                                    <i data-lucide="key"></i>
                                    <p>Nessun codice temporaneo attivo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sharing Page -->
                <div class="page" id="page-sharing" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>Condivisioni</h2>
                            <p>Gestisci chi può accedere ai tuoi dispositivi</p>
                        </div>
                        <button class="btn btn-primary" id="new-share-btn">
                            <i data-lucide="user-plus"></i>
                            Nuovo Invito
                        </button>
                    </div>
                    <div class="sharing-grid">
                        <div class="card full-width">
                            <div class="card-header">
                                <h3>Utenti con Accesso</h3>
                                <div class="filter-group">
                                    <select id="sharing-filter-device">
                                        <option value="all">Tutti i dispositivi</option>
                                    </select>
                                    <select id="sharing-filter-role">
                                        <option value="all">Tutti i ruoli</option>
                                        <option value="manager">Manager</option>
                                        <option value="viewer">Viewer</option>
                                    </select>
                                </div>
                            </div>
                            <div class="shared-users-list" id="shared-users-list">
                                <!-- Users will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Page -->
                <div class="page" id="page-logs" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>Log Accessi</h2>
                            <p>Cronologia completa di tutti gli accessi</p>
                        </div>
                        <button class="btn btn-outline" id="export-logs-btn">
                            <i data-lucide="download"></i>
                            Esporta CSV
                        </button>
                    </div>
                    <div class="card full-width">
                        <div class="card-header">
                            <div class="filter-group">
                                <select id="logs-filter-device">
                                    <option value="all">Tutti i dispositivi</option>
                                </select>
                                <select id="logs-filter-action">
                                    <option value="all">Tutte le azioni</option>
                                    <option value="open">Aperture</option>
                                    <option value="close">Chiusure</option>
                                    <option value="failed">Tentativi falliti</option>
                                </select>
                                <input type="date" id="logs-filter-date">
                            </div>
                        </div>
                        <div class="logs-table-container">
                            <table class="logs-table" id="logs-table">
                                <thead>
                                    <tr>
                                        <th>Data/Ora</th>
                                        <th>Dispositivo</th>
                                        <th>Utente</th>
                                        <th>Azione</th>
                                        <th>Metodo</th>
                                        <th>Posizione</th>
                                        <th>Stato</th>
                                    </tr>
                                </thead>
                                <tbody id="logs-table-body">
                                    <!-- Logs will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="table-pagination" id="logs-pagination">
                            <!-- Pagination will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Alerts Page -->
                <div class="page" id="page-alerts" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>Alert e Notifiche</h2>
                            <p>Gestisci avvisi e configurazioni di alert</p>
                        </div>
                    </div>
                    <div class="alerts-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>Alert Attivi</h3>
                            </div>
                            <div class="alerts-list" id="active-alerts-list">
                                <!-- Alerts will be populated by JavaScript -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Configurazione Alert</h3>
                            </div>
                            <div class="alert-settings">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label">Batteria Bassa</span>
                                        <span class="setting-desc">Avvisa quando la batteria scende sotto la
                                            soglia</span>
                                    </div>
                                    <div class="setting-control">
                                        <input type="range" min="10" max="50" value="20" id="battery-threshold">
                                        <span id="battery-threshold-value">20%</span>
                                    </div>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label">Uscita Geofence</span>
                                        <span class="setting-desc">Avvisa quando il dispositivo esce dal
                                            perimetro</span>
                                    </div>
                                    <label class="toggle">
                                        <input type="checkbox" checked id="geofence-alert">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label">Tentativo di Manomissione</span>
                                        <span class="setting-desc">Avvisa in caso di rilevamento tamper</span>
                                    </div>
                                    <label class="toggle">
                                        <input type="checkbox" checked id="tamper-alert">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-label">Accesso Non Autorizzato</span>
                                        <span class="setting-desc">Avvisa per tentativi di accesso falliti</span>
                                    </div>
                                    <label class="toggle">
                                        <input type="checkbox" checked id="unauthorized-alert">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page" id="page-settings" style="display: none;">
                    <div class="page-header">
                        <div class="page-header-content">
                            <h2>Impostazioni</h2>
                            <p>Configura il tuo account e le preferenze</p>
                        </div>
                    </div>
                    <div class="settings-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>Profilo</h3>
                            </div>
                            <form class="settings-form" id="profile-form">
                                <div class="form-group">
                                    <label>Nome</label>
                                    <input type="text" value="Leonardo" id="setting-name">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="leonardo@esempio.it" id="setting-email">
                                </div>
                                <div class="form-group">
                                    <label>Telefono</label>
                                    <input type="tel" value="+39 333 1234567" id="setting-phone">
                                </div>
                                <button type="submit" class="btn btn-primary">Salva Modifiche</button>
                            </form>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Sicurezza</h3>
                            </div>
                            <div class="security-options">
                                <button class="btn btn-outline btn-block">
                                    <i data-lucide="key"></i>
                                    Cambia Password
                                </button>
                                <button class="btn btn-outline btn-block">
                                    <i data-lucide="smartphone"></i>
                                    Configura 2FA
                                </button>
                                <button class="btn btn-outline btn-block">
                                    <i data-lucide="shield"></i>
                                    Sessioni Attive
                                </button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Abbonamento</h3>
                            </div>
                            <div class="subscription-info">
                                <div class="plan-badge premium">Premium</div>
                                <p class="plan-price">€5.99/mese</p>
                                <p class="plan-renewal">Rinnovo: 15 Gen 2026</p>
                                <button class="btn btn-outline btn-block">Gestisci Abbonamento</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Device Control Modal -->
    <div class="modal" id="device-control-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Controllo Dispositivo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="device-control-body">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Share Access Modal -->
    <div class="modal" id="share-access-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Condividi Accesso</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="share-form">
                    <div class="form-group">
                        <label>Email Destinatario</label>
                        <input type="email" id="share-email" placeholder="email@esempio.it" required>
                    </div>
                    <div class="form-group">
                        <label>Dispositivo</label>
                        <select id="share-device" required>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ruolo</label>
                        <select id="share-role" required>
                            <option value="viewer">Viewer (solo visualizzazione)</option>
                            <option value="manager">Manager (può aprire)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Scadenza</label>
                        <input type="datetime-local" id="share-expires">
                        <span class="form-hint">Lascia vuoto per accesso permanente</span>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close-btn">Annulla</button>
                        <button type="submit" class="btn btn-primary">
                            <i data-lucide="send"></i>
                            Invia Invito
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Generate Temp Code Modal -->
    <div class="modal" id="temp-code-modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Genera Codice Temporaneo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="temp-code-form">
                    <div class="form-group">
                        <label>Dispositivo</label>
                        <select id="temp-code-device" required>
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Validità</label>
                        <select id="temp-code-validity" required>
                            <option value="5">5 minuti</option>
                            <option value="15">15 minuti</option>
                            <option value="30">30 minuti</option>
                            <option value="60">1 ora</option>
                            <option value="1440">24 ore</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Note (opzionale)</label>
                        <input type="text" id="temp-code-note" placeholder="es. Consegna DHL">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close-btn">Annulla</button>
                        <button type="submit" class="btn btn-primary">
                            <i data-lucide="key"></i>
                            Genera Codice
                        </button>
                    </div>
                </form>
                <div class="generated-code-display" id="generated-code-display" style="display: none;">
                    <div class="code-value" id="generated-code-value">A1B2C3</div>
                    <p class="code-expires">Valido per <span id="code-expiry-time">30</span> minuti</p>
                    <button class="btn btn-outline" id="copy-code-btn">
                        <i data-lucide="copy"></i>
                        Copia Codice
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notification-panel">
        <div class="notification-panel-header">
            <h3>Notifiche</h3>
            <button class="btn btn-sm btn-outline" id="mark-all-read">Segna tutto letto</button>
        </div>
        <div class="notification-list" id="notification-list">
            <!-- Notifications populated by JavaScript -->
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>